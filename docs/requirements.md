## サブスク管理Webアプリケーション仕様書

### 1. 概要

本仕様書は、シングルユーザー向けのサブスクリプション管理Webアプリケーションの要件を定義するものです。ユーザーは、自身のサブスクリプションサービスを登録・管理し、月あたりの支払い総額を視覚的に把握できます。

### 2. 主要機能

- **サブスクリプションの登録・管理:**
  - サービス名、金額、通貨（円/ドル）、開始日、終了日（無期限も選択可）、支払いサイクル（月次/年次）を登録できます。
  - 登録済みのサブスクリプションは、編集および削除が可能です。
- **支払い額の可視化:**
  - 月ごとの支払い総額を棒グラフで表示します。
  - ドル建てのサブスクリプションは、登録時点の過去平均為替レート（※後述）を元に円に換算して合算します。
- **ホーム画面:**
  - 現在有効なサブスクリプションの一覧と、当月の支払い総額を表示します。

### 3. 技術スタック

| カテゴリ | コンポーネント | バージョン | 備考 |
| :--- | :--- | :--- | :--- |
| **フロントエンド** | Next.js | 最新安定版 | |
| | shadcn/ui | 最新安定版 | UIフレームワーク |
| | pnpm | 10.14.0 | パッケージマネージャー |
| **バックエンド** | Node.js | 22.17.1 | |
| **データベース** | PostgreSQL | 17.5 | |
| **コンテナ** | Docker | 最新安定版 | DB以外は単一のイメージにまとめる |
| **オーケストレーション**| Kubernetes | 最新安定版 | デプロイ環境 |
| **デプロイツール** | Helm | 最新安定版 | デプロイ用 |
| **API** | OpenAPI | 3.1 | API仕様の定義 |

### 4. API仕様

APIはOpenAPI 3.1に準拠します。詳細は別途、OpenAPIドキュメントとして定義します。

**エンドポイント例:**

- `POST /subscriptions`
  - 新規サブスクリプションを登録
- `GET /subscriptions`
  - 登録済みの全サブスクリプションを取得
- `GET /subscriptions/{id}`
  - 特定のサブスクリプションを取得
- `PUT /subscriptions/{id}`
  - 特定のサブスクリプションを更新
- `DELETE /subscriptions/{id}`
  - 特定のサブスクリプションを削除
- `GET /reports/monthly-summary`
  - 月ごとの支払い総額サマリーを取得

### 5. 為替レートについて

ドル建てのサブスクリプションを円に換算する際は、登録時点から過去30日間の平均為替レートを使用します。為替レートの取得には、外部APIを利用することを想定します。データの取得頻度と期間については、要件に合わせて調整します。

### 6. その他要件

- **ユーザー認証:**
  - シングルユーザーを想定しているため、ユーザー認証機能は実装しません。
- **コンテナ化:**
  - フロントエンドとバックエンドを一つのDockerイメージにまとめ、PostgreSQLとは別のコンテナとしてデプロイします。
- **デプロイ:**
  - Kubernetes環境へのデプロイを前提とし、Helmを利用して一元的に管理します。
